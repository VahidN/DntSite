/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/quill@2.0.3/modules/uiNode.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{ParentBlot}from"parchment";import Module from"../core/module.js";import Quill from"../core/quill.js";const isMac=/Mac/i.test(navigator.platform);export const TTL_FOR_VALID_SELECTION_CHANGE=100;const canMoveCaretBeforeUINode=e=>"ArrowLeft"===e.key||"ArrowRight"===e.key||"ArrowUp"===e.key||"ArrowDown"===e.key||"Home"===e.key||!(!isMac||"a"!==e.key||!0!==e.ctrlKey);class UINode extends Module{isListening=!1;selectionChangeDeadline=0;constructor(e,t){super(e,t),this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(e,t){let{line:n,event:o}=t;if(!(n instanceof ParentBlot&&n.uiNode))return!0;const i="rtl"===getComputedStyle(n.domNode).direction;return!!(i&&"ArrowRight"!==o.key||!i&&"ArrowLeft"!==o.key)||(this.quill.setSelection(e.index-1,e.length+(o.shiftKey?1:0),Quill.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",(e=>{!e.defaultPrevented&&canMoveCaretBeforeUINode(e)&&this.ensureListeningToSelectionChange()}))}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+100,this.isListening)return;this.isListening=!0;document.addEventListener("selectionchange",(()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()}),{once:!0})}handleSelectionChange(){const e=document.getSelection();if(!e)return;const t=e.getRangeAt(0);if(!0!==t.collapsed||0!==t.startOffset)return;const n=this.quill.scroll.find(t.startContainer);if(!(n instanceof ParentBlot&&n.uiNode))return;const o=document.createRange();o.setStartAfter(n.uiNode),o.setEndAfter(n.uiNode),e.removeAllRanges(),e.addRange(o)}}export default UINode;
//# sourceMappingURL=/sm/6d9e36c19dc9d397c02cf51ed7be0af43efcd765fe15656be9424ad873f43313.map