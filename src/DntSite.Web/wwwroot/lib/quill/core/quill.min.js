/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/quill@2.0.3/core/quill.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{merge}from"lodash-es";import*as Parchment from"parchment";import Delta from"quill-delta";import Editor from"./editor.js";import Emitter from"./emitter.js";import instances from"./instances.js";import logger from"./logger.js";import Module from"./module.js";import Selection,{Range}from"./selection.js";import Composition from"./composition.js";import Theme from"./theme.js";import scrollRectIntoView from"./utils/scrollRectIntoView.js";import createRegistryWithFormats from"./utils/createRegistryWithFormats.js";const debug=logger("quill"),globalRegistry=new Parchment.Registry;Parchment.ParentBlot.uiClass="ql-ui";class Quill{static DEFAULTS={bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:globalRegistry,theme:"default"};static events=Emitter.events;static sources=Emitter.sources;static version="2.0.3";static imports={delta:Delta,parchment:Parchment,"core/module":Module,"core/theme":Theme};static debug(t){!0===t&&(t="log"),logger.level(t)}static find(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return instances.get(t)||globalRegistry.find(t,e)}static import(t){return null==this.imports[t]&&debug.error(`Cannot import ${t}. Are you sure it was registered?`),this.imports[t]}static register(){if("string"!=typeof(arguments.length<=0?void 0:arguments[0])){const t=arguments.length<=0?void 0:arguments[0],e=!!(arguments.length<=1?void 0:arguments[1]),i="attrName"in t?t.attrName:t.blotName;"string"==typeof i?this.register(`formats/${i}`,t,e):Object.keys(t).forEach((i=>{this.register(i,t[i],e)}))}else{const t=arguments.length<=0?void 0:arguments[0],e=arguments.length<=1?void 0:arguments[1],i=!!(arguments.length<=2?void 0:arguments[2]);null==this.imports[t]||i||debug.warn(`Overwriting ${t} with`,e),this.imports[t]=e,(t.startsWith("blots/")||t.startsWith("formats/"))&&e&&"boolean"!=typeof e&&"abstract"!==e.blotName&&globalRegistry.register(e),"function"==typeof e.register&&e.register(globalRegistry)}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.options=expandConfig(t,e),this.container=this.options.container,null==this.container)return void debug.error("Invalid Quill container",t);this.options.debug&&Quill.debug(this.options.debug);const i=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",instances.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new Emitter;const o=Parchment.ScrollBlot.blotName,r=this.options.registry.query(o);if(!r||!("blotName"in r))throw new Error(`Cannot initialize Quill without "${o}" blot`);if(this.scroll=new r(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new Editor(this.scroll),this.selection=new Selection(this.scroll,this.emitter),this.composition=new Composition(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(Emitter.events.EDITOR_CHANGE,(t=>{t===Emitter.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())})),this.emitter.on(Emitter.events.SCROLL_UPDATE,((t,e)=>{const i=this.selection.lastRange,[o]=this.selection.getRange(),r=i&&o?{oldRange:i,newRange:o}:void 0;modify.call(this,(()=>this.editor.update(null,e,r)),t)})),this.emitter.on(Emitter.events.SCROLL_EMBED_UPDATE,((t,e)=>{const i=this.selection.lastRange,[o]=this.selection.getRange(),r=i&&o?{oldRange:i,newRange:o}:void 0;modify.call(this,(()=>{const i=(new Delta).retain(t.offset(this)).retain({[t.statics.blotName]:e});return this.editor.update(i,[],r)}),Quill.sources.USER)})),i){const t=this.clipboard.convert({html:`${i}<p><br></p>`,text:"\n"});this.setContents(t)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"==typeof t){const e=t;(t=document.createElement("div")).classList.add(e)}return this.container.insertBefore(t,e),t}blur(){this.selection.setRange(null)}deleteText(t,e,i){return[t,e,,i]=overload(t,e,i),modify.call(this,(()=>this.editor.deleteText(t,e)),i,t,-1*e)}disable(){this.enable(!1)}editReadOnly(t){this.allowReadOnlyEdits=!0;const e=t();return this.allowReadOnlyEdits=!1,e}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.scroll.enable(t),this.container.classList.toggle("ql-disabled",!t)}focus(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selection.focus(),t.preventScroll||this.scrollSelectionIntoView()}format(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Emitter.sources.API;return modify.call(this,(()=>{const i=this.getSelection(!0);let o=new Delta;if(null==i)return o;if(this.scroll.query(t,Parchment.Scope.BLOCK))o=this.editor.formatLine(i.index,i.length,{[t]:e});else{if(0===i.length)return this.selection.format(t,e),o;o=this.editor.formatText(i.index,i.length,{[t]:e})}return this.setSelection(i,Emitter.sources.SILENT),o}),i)}formatLine(t,e,i,o,r){let s;return[t,e,s,r]=overload(t,e,i,o,r),modify.call(this,(()=>this.editor.formatLine(t,e,s)),r,t,0)}formatText(t,e,i,o,r){let s;return[t,e,s,r]=overload(t,e,i,o,r),modify.call(this,(()=>this.editor.formatText(t,e,s)),r,t,0)}getBounds(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=null;if(i="number"==typeof t?this.selection.getBounds(t,e):this.selection.getBounds(t.index,t.length),!i)return null;const o=this.container.getBoundingClientRect();return{bottom:i.bottom-o.top,height:i.height,left:i.left-o.left,right:i.right-o.left,top:i.top-o.top,width:i.width}}getContents(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getLength()-t;return[t,e]=overload(t,e),this.editor.getContents(t,e)}getFormat(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelection(!0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"number"==typeof t?this.editor.getFormat(t,e):this.editor.getFormat(t.index,t.length)}getIndex(t){return t.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(t){return this.scroll.leaf(t)}getLine(t){return this.scroll.line(t)}getLines(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;return"number"!=typeof t?this.scroll.lines(t.index,t.length):this.scroll.lines(t,e)}getModule(t){return this.theme.modules[t]}getSelection(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;return"number"==typeof t&&(e=e??this.getLength()-t),[t,e]=overload(t,e),this.editor.getHTML(t,e)}getText(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;return"number"==typeof t&&(e=e??this.getLength()-t),[t,e]=overload(t,e),this.editor.getText(t,e)}hasFocus(){return this.selection.hasFocus()}insertEmbed(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Quill.sources.API;return modify.call(this,(()=>this.editor.insertEmbed(t,e,i)),o,t)}insertText(t,e,i,o,r){let s;return[t,,s,r]=overload(t,0,i,o,r),modify.call(this,(()=>this.editor.insertText(t,e,s)),r,t,e.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(t,e,i){return[t,e,,i]=overload(t,e,i),modify.call(this,(()=>this.editor.removeFormat(t,e)),i,t)}scrollRectIntoView(t){scrollRectIntoView(this.root,t)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const t=this.selection.lastRange,e=t&&this.selection.getBounds(t.index,t.length);e&&this.scrollRectIntoView(e)}setContents(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Emitter.sources.API;return modify.call(this,(()=>{t=new Delta(t);const e=this.getLength(),i=this.editor.deleteText(0,e),o=this.editor.insertContents(0,t),r=this.editor.deleteText(this.getLength()-1,1);return i.compose(o).compose(r)}),e)}setSelection(t,e,i){null==t?this.selection.setRange(null,e||Quill.sources.API):([t,e,,i]=overload(t,e,i),this.selection.setRange(new Range(Math.max(0,t),e),i),i!==Emitter.sources.SILENT&&this.scrollSelectionIntoView())}setText(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Emitter.sources.API;const i=(new Delta).insert(t);return this.setContents(i,e)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Emitter.sources.USER;const e=this.scroll.update(t);return this.selection.update(t),e}updateContents(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Emitter.sources.API;return modify.call(this,(()=>(t=new Delta(t),this.editor.applyDelta(t))),e,!0)}}function resolveSelector(t){return"string"==typeof t?document.querySelector(t):t}function expandModuleConfig(t){return Object.entries(t??{}).reduce(((t,e)=>{let[i,o]=e;return{...t,[i]:!0===o?{}:o}}),{})}function omitUndefinedValuesFromOptions(t){return Object.fromEntries(Object.entries(t).filter((t=>void 0!==t[1])))}function expandConfig(t,e){const i=resolveSelector(t);if(!i)throw new Error("Invalid Quill container");const o=!e.theme||e.theme===Quill.DEFAULTS.theme?Theme:Quill.import(`themes/${e.theme}`);if(!o)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:r,...s}=Quill.DEFAULTS,{modules:n,...l}=o.DEFAULTS;let h=expandModuleConfig(e.modules);null!=h&&h.toolbar&&h.toolbar.constructor!==Object&&(h={...h,toolbar:{container:h.toolbar}});const a=merge({},expandModuleConfig(r),expandModuleConfig(n),h),d={...s,...omitUndefinedValuesFromOptions(l),...omitUndefinedValuesFromOptions(e)};let c=e.registry;return c?e.formats&&debug.warn('Ignoring "formats" option because "registry" is specified'):c=e.formats?createRegistryWithFormats(e.formats,d.registry,debug):d.registry,{...d,registry:c,container:i,theme:o,modules:Object.entries(a).reduce(((t,e)=>{let[i,o]=e;if(!o)return t;const r=Quill.import(`modules/${i}`);return null==r?(debug.error(`Cannot load ${i} module. Are you sure you registered it?`),t):{...t,[i]:merge({},r.DEFAULTS||{},o)}}),{}),bounds:resolveSelector(d.bounds)}}function modify(t,e,i,o){if(!this.isEnabled()&&e===Emitter.sources.USER&&!this.allowReadOnlyEdits)return new Delta;let r=null==i?null:this.getSelection();const s=this.editor.delta,n=t();if(null!=r&&(!0===i&&(i=r.index),null==o?r=shiftRange(r,n,e):0!==o&&(r=shiftRange(r,i,o,e)),this.setSelection(r,Emitter.sources.SILENT)),n.length()>0){const t=[Emitter.events.TEXT_CHANGE,n,s,e];this.emitter.emit(Emitter.events.EDITOR_CHANGE,...t),e!==Emitter.sources.SILENT&&this.emitter.emit(...t)}return n}function overload(t,e,i,o,r){let s={};return"number"==typeof t.index&&"number"==typeof t.length?"number"!=typeof e?(r=o,o=i,i=e,e=t.length,t=t.index):(e=t.length,t=t.index):"number"!=typeof e&&(r=o,o=i,i=e,e=0),"object"==typeof i?(s=i,r=o):"string"==typeof i&&(null!=o?s[i]=o:r=i),[t,e,s,r=r||Emitter.sources.API]}function shiftRange(t,e,i,o){const r="number"==typeof i?i:0;if(null==t)return null;let s,n;return e&&"function"==typeof e.transformPosition?[s,n]=[t.index,t.index+t.length].map((t=>e.transformPosition(t,o!==Emitter.sources.USER))):[s,n]=[t.index,t.index+t.length].map((t=>t<e||t===e&&o===Emitter.sources.USER?t:r>=0?t+r:Math.max(e,t+r))),new Range(s,n-s)}export{Parchment,Range};export{globalRegistry,expandConfig,overload,Quill as default};
//# sourceMappingURL=/sm/f36551d761bd3522f02d4d78a05361fd2656370c7e4d58829259b18f4daa548d.map